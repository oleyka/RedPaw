---
# ansible-playbook bootstrap.yml -i hosts -vvv

- hosts: sites
  pre_tasks:
    - name: grab the git email
      local_action: command /usr/local/bin/git config user.email
      register: git_email
    - name: create directory for custom repo settings
      sudo: yes
      file:
        name: /usr/local/etc/pkg/repos
        state: directory
    - name: copy custom repo config
      sudo: yes
      copy:
        src: files/repos-FreeBSD.conf
        dest: /usr/local/etc/pkg/repos/FreeBSD.conf

  vars:
    user_email: git_email.stdout
    ssl_source: 'letsencrypt'

  tasks:
    - name: install the site packages
      sudo: yes
      pkgng:
        name: "{{ item }}"
        state: present
      with_items:
        - collectd
        - py27-supervisor
        - nginx
        - py27-django
      when: ansible_os_family == 'FreeBSD'

  roles:
    - ssl
#    - snmp
